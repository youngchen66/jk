<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>K5 英文句型遊戲</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f8ff;
      text-align: center;
      padding: 40px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    .sentence-box, .word-bank {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      min-height: 60px;
      padding: 10px;
      border: 2px dashed #ccc;
      background: #fafafa;
    }
    .word {
      background: #e0f7fa;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 6px;
      cursor: grab;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container" id="game-section">
    <h2>✍️ 組合英文句子</h2>
    <div><strong>提示：</strong><span id="hint"></span></div>
    <img id="question-img" src="" alt="" style="max-width: 100%; margin-top: 10px;">
    <div id="word-bank" class="word-bank"></div>
    <div id="sentence-box" class="sentence-box" ondragover="event.preventDefault()" ondrop="drop(event)"></div>
    <button onclick="checkSentence()">✅ 確認句子</button>
    <button onclick="speakSentence()">🔊 朗讀句子</button>
    <button onclick="nextQuestion()">➡️ 下一題</button>
    <p id="feedback"></p>
    <p id="progress"></p>
  </div>

  <script>
    let currentIndex = 0;

    const questionBank = [
      { sentence: ["I", "like", "apples"], hint: "我喜歡蘋果", img: "images/q1.jpg" },
      { sentence: ["She", "has", "a", "cat"], hint: "她有一隻貓", img: "images/q2.jpg" },
      { sentence: ["Let’s", "go", "to", "the", "zoo"], hint: "我們去動物園吧！", img: "images/q100.jpg" },
      { sentence: ["The", "students", "are", "cleaning", "the", "classroom", "together", "this", "morning"], hint: "學生們今天早上一起打掃教室", img: "images/q101.jpg" }
    ];

    function loadGame() {
      const q = questionBank[currentIndex];
      document.getElementById("hint").textContent = q.hint;
      document.getElementById("question-img").src = q.img;
      const wordBank = document.getElementById("word-bank");
      wordBank.innerHTML = "";
      document.getElementById("sentence-box").innerHTML = "";
      document.getElementById("feedback").textContent = "";
      [...q.sentence].sort(() => Math.random() - 0.5).forEach(word => {
        const span = document.createElement("span");
        span.className = "word";
        span.draggable = true;
        span.textContent = word;
        span.ondragstart = e => e.dataTransfer.setData("text", word);
        wordBank.appendChild(span);
      });
      updateProgress();
    }

    function drop(e) {
      const word = e.dataTransfer.getData("text");
      if (word) {
        const span = document.createElement("span");
        span.className = "word";
        span.textContent = word;
        document.getElementById("sentence-box").appendChild(span);
      }
    }

    function checkSentence() {
      const correct = questionBank[currentIndex].sentence.join(" ");
      const user = Array.from(document.getElementById("sentence-box").children).map(el => el.textContent).join(" ");
      const feedback = document.getElementById("feedback");
      if (user === correct) {
        feedback.textContent = "🎉 答對了！";
        feedback.style.color = "green";
      } else {
        feedback.textContent = `❌ 答錯了，正確答案：${correct}`;
        feedback.style.color = "red";
      }
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex >= questionBank.length) {
        alert("🎉 遊戲完成！請重新開始。");
        currentIndex = 0;
      }
      loadGame();
    }

    function speakSentence() {
      const sentence = questionBank[currentIndex].sentence.join(" ");
      const utterance = new SpeechSynthesisUtterance(sentence);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
    }

    function updateProgress() {
      document.getElementById("progress").textContent = `進度：第 ${currentIndex + 1} 題 / 共 ${questionBank.length} 題`;
    }

    window.onload = loadGame;
  </script>
</body>
</html>
